<!-- Update template path -->
{% extends "base.html" %}

{% block title %}Dashboard{% endblock %}

{% block extra_head %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
{% endblock %}

{% block content %}
<div class="dashboard">
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <i class="fas fa-leaf"></i>
            <h2>Plant Monitor</h2>
        </div>
        <nav class="sidebar-nav">
            <a href="#" class="active">
                <i class="fas fa-home"></i>
                Dashboard
            </a>
            <a href="#">
                <i class="fas fa-seedling"></i>
                My Plants
            </a>
            <a href="#">
                <i class="fas fa-chart-line"></i>
                Statistics
            </a>
            <a href="#">
                <i class="fas fa-cog"></i>
                Settings
            </a>
        </nav>
        <div class="sidebar-footer">
            <a href="{{ url_for('auth.logout') }}" class="logout-btn">
                <i class="fas fa-sign-out-alt"></i>
                Logout
            </a>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <header class="dashboard-header">
            <div class="header-title">
                <h1>Welcome Back!</h1>
                <p>{{ session['email'] }}</p>
            </div>
            <button class="btn-primary" onclick="showAddPlantModal()">
                <i class="fas fa-plus"></i>
                Add New Plant
            </button>
        </header>

        <!-- Overview Cards -->
        <div class="overview-cards">
            <div class="card">
                <i class="fas fa-seedling"></i>
                <div class="card-info">
                    <h3>Total Plants</h3>
                    <p>{{ plants|length }}</p>
                </div>
            </div>
            <div class="card">
                <i class="fas fa-tint"></i>
                <div class="card-info">
                    <h3>Need Water</h3>
                    <p>{{ plants|selectattr('moisture_level', '<', 30)|list|length }}</p>
                </div>
            </div>
            <div class="card">
                <i class="fas fa-thermometer-half"></i>
                <div class="card-info">
                    <h3>Avg Temperature</h3>
                    <p>24°C</p>
                </div>
            </div>
        </div>

        <!-- Plants Grid -->
        <div class="plants-grid">
            {% for plant in plants %}
            <div class="plant-card">
                <div class="plant-header">
                    <h3>{{ plant.name }}</h3>
                    <span class="plant-type">{{ plant.type }}</span>
                </div>
                <div class="plant-stats">
                    <div class="stat">
                        <i class="fas fa-tint"></i>
                        <div class="stat-info">
                            <span class="stat-label">Moisture</span>
                            <span class="stat-value">{{ plant.moisture_level }}%</span>
                        </div>
                    </div>
                    <div class="stat">
                        <i class="fas fa-thermometer-half"></i>
                        <div class="stat-info">
                            <span class="stat-label">Temperature</span>
                            <span class="stat-value">{{ plant.temperature }}°C</span>
                        </div>
                    </div>
                </div>
                <div class="plant-footer">
                    <span class="last-watered">
                        <i class="fas fa-clock"></i>
                        Last watered: {{ plant.last_watered.strftime('%Y-%m-%d %H:%M') }}
                    </span>
                </div>
            </div>
            {% endfor %}
        </div>
    </main>
</div>

<!-- Add Plant Modal -->
<div id="addPlantModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Add New Plant</h2>
            <span class="close" onclick="closeAddPlantModal()">&times;</span>
        </div>
        <form method="POST" action="{{ url_for('main.add_plant') }}">
            <div class="form-group">
                <label for="plant_name">Plant Name</label>
                <input type="text" id="plant_name" name="plant_name" required>
            </div>
            <div class="form-group">
                <label for="plant_type">Plant Type</label>
                <select id="plant_type" name="plant_type" required>
                    <option value="">Select plant type</option>
                    <option value="Succulent">Succulent</option>
                    <option value="Herb">Herb</option>
                    <option value="Flower">Flower</option>
                    <option value="Vegetable">Vegetable</option>
                    <option value="Indoor Plant">Indoor Plant</option>
                </select>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-secondary" onclick="closeAddPlantModal()">Cancel</button>
                <button type="submit" class="btn-primary">Add Plant</button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function showAddPlantModal() {
    document.getElementById('addPlantModal').style.display = 'block';
}

function closeAddPlantModal() {
    document.getElementById('addPlantModal').style.display = 'none';
}

// Close modal when clicking outside
window.onclick = function(event) {
    const modal = document.getElementById('addPlantModal');
    if (event.target == modal) {
        closeAddPlantModal();
    }
}
</script>
{% endblock %} 